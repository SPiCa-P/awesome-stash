name: BiliBili 海外 CDN 重定向
desc: 加载更流畅的 BiliBili 更值得干杯🍻！（需要 MitM）

http:
  force-http-engine:
    - "*-mirrorakam.akamaized.net:80"
    - "*.bilivideo.com:80"
  mitm:
    - "*-mirrorakam.akamaized.net:443"
    - "*.bilivideo.com:443"
  url-rewrite:
    - https?:\/\/.*-mirrorakam\.akamaized\.net\/upgcxcode - reject
    - https?:\/\/(.*)\.bilivideo\.com\/upgcxcode\/ http://upos-sz-mirroraliov.bilivideo.com transparent

script:
  shortcuts:
    bilibili-quic: network == 'udp' and geoip(dst_ip) == 'CN' and dst_port == 3478
    bilibili-shit: ('pcdn' in host and 'biliapi' in host) or ('p2p' in host and 'bilibili' in host)
    bilibili-cn-pcdn: geoip(dst_ip) == 'CN' and dst_port == 8000
rules:
  - SCRIPT,bilibili-quic,REJECT
  - SCRIPT,bilibili-shit,REJECT
  - SCRIPT,bilibili-cn-pcdn,REJECT
