name: BiliBili æµ·å¤– CDN é‡å®šå‘
desc: åŠ è½½æ›´æµç•…çš„ BiliBili æ›´å€¼å¾—å¹²æ¯ğŸ»ï¼ï¼ˆéœ€è¦ MitMï¼‰

http:
  force-http-engine:
    - "*-mirrorakam.akamaized.net:80"
    - "*.bilivideo.com:80"
  mitm:
    - "*-mirrorakam.akamaized.net:443"
    - "*.bilivideo.com:443"
  url-rewrite:
    - https?:\/\/.*-mirrorakam\.akamaized\.net\/upgcxcode - reject
    - https?:\/\/(.*)\.bilivideo\.com\/upgcxcode\/ http://upos-sz-mirroraliov.bilivideo.com transparent

script:
  shortcuts:
    bilibili-quic: network == 'udp' and geoip(dst_ip) == 'CN' and dst_port == 3478
    bilibili-shit: ('pcdn' in host and 'biliapi' in host) or ('p2p' in host and 'bilibili' in host)
    bilibili-cn-pcdn: geoip(dst_ip) == 'CN' and dst_port == 8000
rules:
  - SCRIPT,bilibili-quic,REJECT
  - SCRIPT,bilibili-shit,REJECT
  - SCRIPT,bilibili-cn-pcdn,REJECT
